#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

# Pre-commit hook to prevent Chrome profile and large files from being committed

echo "ðŸ” Pre-commit: Checking for problematic files..."

# Check for Chrome profile files
CHROME_FILES=$(git diff --cached --name-only | grep -E "(\.chrome-profile|Cache_Data|Safe Browsing|IndexedDB|leveldb)" || true)
if [ ! -z "$CHROME_FILES" ]; then
  echo "âŒ Chrome profile files detected in commit:"
  echo "$CHROME_FILES"
  echo ""
  echo "These files should never be committed. Please remove them with:"
  echo "git reset HEAD $CHROME_FILES"
  exit 1
fi

# Check for demo CSV files in root
DEMO_FILES=$(git diff --cached --name-only | grep "^DEMO_.*\.csv$" || true)
if [ ! -z "$DEMO_FILES" ]; then
  echo "âš ï¸  Warning: Demo CSV files detected in root directory:"
  echo "$DEMO_FILES"
  echo "Consider moving these to archive/data/demo/"
fi

# Check for large binary files (>1MB)
LARGE_FILES=$(git diff --cached --name-only -z | xargs -0 -I {} sh -c 'test -f "{}" && find "{}" -size +1M 2>/dev/null' | head -10 || true)
if [ ! -z "$LARGE_FILES" ]; then
  echo "âš ï¸  Warning: Large files detected (>1MB):"
  echo "$LARGE_FILES"
  echo "Consider if these files should be in Git."
fi

echo "âœ… Pre-commit checks passed"