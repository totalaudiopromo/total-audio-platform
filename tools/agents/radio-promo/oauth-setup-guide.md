# Google OAuth Setup Guide - Liberty Radio Promo Agent

## Current Status ‚ö†Ô∏è
OAuth URL generation works, but Google Cloud Console needs configuration updates to complete the flow.

**Project**: `gleaming-realm-471715-p3`
**OAuth Client ID**: `309298460159-4gcfsvpup4og77r0mifta91s8f651875.apps.googleusercontent.com`

## Required Google Cloud Console Updates

### 1. OAuth Consent Screen
**URL**: https://console.cloud.google.com/apis/credentials/consent?project=gleaming-realm-471715-p3

**Actions needed**:
- Add authorized domains:
  - `localhost`
  - `127.0.0.1`
- Set app type to "External" if testing
- Add test users if needed

### 2. OAuth Credentials
**URL**: https://console.cloud.google.com/apis/credentials?project=gleaming-realm-471715-p3

**Actions needed**:
- Edit the OAuth 2.0 Client ID: `309298460159-4gcfsvpup4og77r0mifta91s8f651875.apps.googleusercontent.com`
- Add these redirect URIs:
  - `http://localhost:8080`
  - `http://127.0.0.1:8080`
  - `postmessage` (already exists)
  - `urn:ietf:wg:oauth:2.0:oob`

### 3. Enable Required APIs

#### Gmail API
**URL**: https://console.cloud.google.com/apis/library/gmail.googleapis.com?project=gleaming-realm-471715-p3
- Click "Enable" if not already enabled

#### Drive API
**URL**: https://console.cloud.google.com/apis/library/drive.googleapis.com?project=gleaming-realm-471715-p3
- Click "Enable" if not already enabled

#### Calendar API
**URL**: https://console.cloud.google.com/apis/library/calendar-json.googleapis.com?project=gleaming-realm-471715-p3
- Click "Enable" if not already enabled

## Testing the Setup

After making the above changes:

1. **Generate OAuth URL**:
   ```bash
   cd tools/agents/radio-promo
   node simple-oauth-test.js
   ```

2. **Open the generated URL** in your browser

3. **Complete OAuth flow** and copy the authorization code

4. **Exchange code for tokens**:
   ```bash
   node simple-oauth-test.js YOUR_AUTH_CODE_HERE
   ```

5. **Test agent integration**:
   ```bash
   node radio-promo-agent.js find-liberty-campaigns-gmail
   ```

## Expected Success Output

When working correctly, you should see:
```
‚úÖ Tokens saved successfully!
   File: /path/to/gmail-token.json

üß™ Testing connection...
   ‚úÖ Gmail: Connected as your-email@gmail.com
   ‚úÖ Drive: Connected as Your Name
   ‚úÖ Calendar: Connected with X calendars

üéâ OAuth setup complete!
```

## Troubleshooting

### Error: `invalid_client`
- OAuth consent screen not configured
- Missing authorized domains
- Check the consent screen URL above

### Error: `no registered origin`
- Missing redirect URIs in OAuth credentials
- Add the redirect URIs listed above

### Error: `invalid_grant`
- Authorization code expired (get a fresh one)
- Code copied incorrectly
- Try the OAuth flow again

## Files Involved

- `gmail-credentials.json` - OAuth client credentials
- `gmail-token.json` - Access/refresh tokens (created after successful OAuth)
- `simple-oauth-test.js` - OAuth testing script
- `integrations/gmail-api.js` - Gmail integration logic

## Current Working OAuth URL

The current OAuth URL (generated by test script):
```
https://accounts.google.com/o/oauth2/v2/auth?access_type=offline&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fgmail.readonly%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive.readonly%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcalendar.readonly&prompt=consent&response_type=code&client_id=309298460159-4gcfsvpup4og77r0mifta91s8f651875.apps.googleusercontent.com&redirect_uri=postmessage
```

This URL works for generation but will fail on authorization without the Google Cloud Console updates above.